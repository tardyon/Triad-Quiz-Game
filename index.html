<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Triad Quiz Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      text-align: center; /* Center all text */
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    .options {
      margin-bottom: 20px;
      text-align: left; /* Align options to the left */
    }
    .options summary {
      font-size: 1.5em;
      font-weight: bold;
      cursor: pointer;
    }
    .options details[open] summary::before {
      content: "▼ ";
    }
    .options summary::before {
      content: "► ";
    }
    #quiz-area {
      margin-top: 20px;
    }
    #quiz-question {
      font-size: 3em; /* Large font size */
      margin-bottom: 30px;
    }
    #reveal-button, #correct-button, #wrong-button, #reset-button {
      margin: 10px;
      padding: 15px 25px; /* Adjusted padding for better spacing */
      font-size: 1.2em; /* Adjusted font size */
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #007BFF;
      color: white;
      transition: background-color 0.3s;
    }
    #reveal-button:hover, #correct-button:hover, #wrong-button:hover, #reset-button:hover {
      background-color: #0056b3;
    }
    #answer {
      font-size: 2.5em; /* Large font size */
      margin-bottom: 30px;
      color: #28a745;
    }
    #progress {
      margin-top: 20px;
      font-size: 1.2em;
    }
    #start-button {
      margin-top: 20px;
      padding: 15px 25px; /* Adjusted padding for better spacing */
      font-size: 1.2em; /* Adjusted font size */
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #28a745;
      color: white;
      transition: background-color 0.3s;
    }
    #start-button:hover {
      background-color: #1e7e34;
    }
    #footer {
      margin-top: 40px;
      font-size: 0.9em;
      color: gray;
    }
    #footer p {
      margin: 5px 0;
    }
    h1, h2 {
      text-align: center;
    }
    input[type="checkbox"], input[type="radio"] {
      transform: scale(1.3);
      margin-right: 10px;
    }
    /* Missed Questions Styles */
    #missed-questions {
      margin-top: 20px;
      text-align: left;
    }
    #missed-questions h2 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    #missed-list {
      list-style-type: none;
      padding: 0;
    }
    #missed-list li {
      font-size: 1.2em;
      margin-bottom: 5px;
    }
    /* Instructions Toggle Button */
    #instructions-button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #6c757d;
      color: white;
      transition: background-color 0.3s;
    }
    #instructions-button:hover {
      background-color: #5a6268;
    }
    /* Instructions Manual Styles */
    #instructions-manual {
      display: none;
      text-align: left;
      margin-top: 20px;
      padding: 20px;
      background-color: #ffffff;
      border: 1px solid #ced4da;
      border-radius: 5px;
    }
    #instructions-manual h2 {
      text-align: center;
      margin-bottom: 15px;
    }
    #instructions-manual p {
      margin-bottom: 10px;
    }
    /* Responsive Design */
    @media (max-width: 600px) {
      #quiz-question {
        font-size: 2em;
      }
      #answer {
        font-size: 2em;
      }
      #reveal-button, #correct-button, #wrong-button, #reset-button, #start-button, #instructions-button {
        padding: 10px 20px;
        font-size: 1em;
      }
      .options summary {
        font-size: 1.2em;
      }
      .options label {
        font-size: 1em;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Triad Quiz Game v1.6.1</h1>
    <p>This game helps you learn and practice identifying the four types of triads.</p>
    <p>If a chord doesn't match the spelling of any of these types, consider choosing a different root note.</p>
    <p>Any change in option selection requires a "Reset Game" to take effect.</p>
    
    <!-- Instructions Toggle Button -->
    <button id="instructions-button">Show Instructions</button>
    
    <!-- Instructions Manual -->
    <div id="instructions-manual">
      <h2>Instructions Manual</h2>
      <p>Welcome to the Triad Quiz Game! This tool is designed to help you practice and improve your ability to identify and spell different types of triads based on selected root notes and configurations.</p>
      
      <h3>How to Use the Quiz:</h3>
      <ol>
        <li><strong>Select Triad Selection Options:</strong> Click on the "Triad Selection Options" section to expand it and configure your desired settings.</li>
        <li><strong>Select Quiz Mode:</strong> Choose between "Name the Chord" or "Spell the Chord" modes by selecting the appropriate radio button.</li>
        <li><strong>Start the Quiz:</strong> After configuring your options, click the "Start Quiz" button to begin.</li>
        <li><strong>Interacting with the Quiz:</strong>
          <ul>
            <li><em>Reveal Answer:</em> Click the "Reveal Answer" button or press the <strong>Space Bar</strong> to display the correct answer.</li>
            <li><em>Mark as Correct:</em> If you answered correctly, click "I Was Correct" or press the <strong>'.' Key</strong>.</li>
            <li><em>Mark as Wrong:</em> If you answered incorrectly, click "I Was Wrong" or press the <strong>',' Key</strong>. Missed questions will be tracked for review.</li>
          </ul>
        </li>
        <li><strong>Resetting the Quiz:</strong> To apply any changes in your selections, click the "Reset Game" button. This will hide the quiz area and bring you back to the initial settings screen.</li>
      </ol>
      
      <h3>Tips for Effective Learning:</h3>
      <ul>
        <li>Start with natural root notes to build a strong foundation before introducing sharps and flats.</li>
        <li>Gradually incorporate theoretical enharmonics and Circle of Fifths preferences to challenge your understanding.</li>
        <li>Review missed questions to identify areas that need improvement.</li>
      </ul>
      
      <h3>Keyboard Shortcuts:</h3>
      <ul>
        <li><strong>Space Bar:</strong> Reveal the answer.</li>
        <li><strong>'.' Key:</strong> Mark the answer as correct.</li>
        <li><strong>',' Key:</strong> Mark the answer as wrong.</li>
      </ul>
    </div>
    
    <!-- Triad Selection Options -->
    <div class="options">
      <details>
        <summary>Triad Selection Options</summary>
        <!-- Triad Types Selection -->
        <div class="options">
          <h3>Select Triad Types:</h3>
          <label><input type="checkbox" id="major" checked> Major</label>
          <label><input type="checkbox" id="minor" checked> Minor</label>
          <label><input type="checkbox" id="diminished" checked> Diminished</label>
          <label><input type="checkbox" id="augmented" checked> Augmented</label>
        </div>
        
        <!-- Inversions Selection -->
        <div class="options">
          <h3>Select Inversions:</h3>
          <label><input type="checkbox" name="inversion" value="root" checked> Root Inversion</label>
          <label><input type="checkbox" name="inversion" value="first" checked> First Inversion</label>
          <label><input type="checkbox" name="inversion" value="second" checked> Second Inversion</label>
        </div>
        
        <!-- Voicing Selection -->
        <div class="options">
          <h3>Select Voicing:</h3>
          <label><input type="checkbox" id="spread-voicing"> Spread (Open Chord) Voicing</label>
        </div>
        
        <!-- Root Note Accidental Selection -->
        <div class="options">
          <h3>Select Root Note Accidental:</h3>
          <label><input type="checkbox" id="naturals"> Naturals</label>
          <label><input type="checkbox" id="sharps"> Sharps (#)</label>
          <label><input type="checkbox" id="flats"> Flats (b)</label>
        </div>
        
        <!-- Root Note Enharmonic Options -->
        <div class="options">
          <h3>Select Root Note Enharmonic Options:</h3>
          <label><input type="checkbox" id="theoretical-enharmonics"> Theoretical Enharmonics</label>
          <label><input type="checkbox" id="circle-enharmonics"> Follow Circle of Fifths Enharmonic</label>
        </div>
      </details>
    </div>
    
    <!-- Quiz Mode Selection -->
    <div class="options">
      <details>
        <summary>Select Quiz Mode</summary>
        <label><input type="radio" name="mode" value="name" checked> Name the Chord</label>
        <label><input type="radio" name="mode" value="spell"> Spell the Chord</label>
      </details>
    </div>
    
    <!-- Start Quiz Button -->
    <button id="start-button">Start Quiz</button>
    
    <!-- Quiz Area -->
    <div id="quiz-area" style="display: none;">
      <div id="quiz-question"></div>
      <button id="reveal-button">Reveal Answer (Space Bar)</button>
      <div id="answer" style="display: none;"></div>
      <button id="correct-button" style="display: none;">I Was Correct ('.' Key)</button>
      <button id="wrong-button" style="display: none;">I Was Wrong (',' Key)</button>
      <button id="reset-button">Reset Game</button>
      <div id="progress"></div>
    </div>
    
    <!-- Footer -->
    <div id="footer">
      <p>© 2024 Michael C.M. Varney</p>
      <p>Version 1.6.1</p>
    </div>

    <!-- Missed Questions at the Bottom -->
    <div id="missed-questions">
      <h2>Missed Questions</h2>
      <ul id="missed-list"></ul>
    </div>

  </div>
  
  <script>
    (function() {
      // Updated Root Notes Including Single Accidentals
      const allRootNotes = [
        'C', 'C#', 'Db',
        'D', 'D#', 'Eb',
        'E', 'Fb',
        'F', 'F#', 'Gb',
        'G', 'G#', 'Ab',
        'A', 'A#', 'Bb',
        'B', 'Cb'
      ];

      // Theoretical Enharmonics
      const theoreticalEnharmonics = ['E#', 'Fb', 'B#', 'Cb'];

      // Circle of Fifths Preferred Enharmonics
      const circleOfFifthsPreferred = {
        'C#': 'C#',
        'Db': 'C#', // Prefer C# over Db
        'D#': 'D#',
        'Eb': 'D#', // Prefer D# over Eb
        'F#': 'F#',
        'Gb': 'F#', // Prefer F# over Gb
        'G#': 'G#',
        'Ab': 'G#', // Prefer G# over Ab
        'A#': 'A#',
        'Bb': 'A#', // Prefer A# over Bb
        'Cb': 'B',  // Prefer B over Cb
        'B#': 'C',  // Prefer C over B#
        'E#': 'F',  // Prefer F over E#
        'Fb': 'E'   // Prefer E over Fb
      };

      const triadTypes = [
        { name: 'Major', formula: ['1', '3', '5'], symmetrical: false },
        { name: 'Minor', formula: ['1', 'b3', '5'], symmetrical: false },
        { name: 'Diminished', formula: ['1', 'b3', 'b5'], symmetrical: false },
        { name: 'Augmented', formula: ['1', '3', '#5'], symmetrical: false }
      ];

      const noteLetters = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];

      const semitoneMap = {
        'C': 0,
        'C#': 1,
        'Db': 1,
        'D': 2,
        'D#': 3,
        'Eb': 3,
        'E': 4,
        'Fb': 4,
        'E#': 5,
        'F': 5,
        'F#': 6,
        'Gb': 6,
        'G': 7,
        'G#': 8,
        'Ab': 8,
        'A': 9,
        'A#': 10,
        'Bb': 10,
        'B': 11,
        'Cb': 11,
        'B#': 0, // Enharmonic to C
        'C##': 2, // Not used as per requirements
        'Cbb': -2, // Not used as per requirements
        'Fb': 4,
        'E#': 5,
        'B#': 0,
        'Cb': 11
      };

      let quizSet = [];
      let currentQuestionIndex = 0;
      let currentQuestion = null;
      let correctAnswers = 0;
      let incorrectAttempts = 0;
      let totalQuestions = 0;
      let missedQuestions = {};

      // Function to build the major scale based on root and sharps preference
      function buildMajorScale(root, useSharps) {
        const semitones = [0, 2, 4, 5, 7, 9, 11];
        const scale = [];
        const rootIndex = noteLetters.indexOf(root.charAt(0));
        for (let i = 0; i < 7; i++) {
          const letter = noteLetters[(rootIndex + i) % 7];
          const midi = (semitoneMap[root] + semitones[i]) % 12;
          const noteName = findNoteName(letter, midi, useSharps);
          if (!noteName) return null;
          scale.push(noteName);
        }
        return scale;
      }

      // Function to find note name based on letter, midi, and sharps preference
      function findNoteName(letter, midi, useSharps) {
        const accidentals = useSharps ? ['#', ''] : ['b', ''];
        for (let accidental of accidentals) {
          const noteName = letter + accidental;
          if (semitoneMap[noteName] !== undefined && (semitoneMap[noteName] % 12 === midi)) {
            return noteName;
          }
        }
        // Fallback to include double accidentals
        const allAccidentals = ['##', 'bb'];
        for (let accidental of allAccidentals) {
          const noteName = letter + accidental;
          if (semitoneMap[noteName] !== undefined && (semitoneMap[noteName] % 12 === midi)) {
            return noteName;
          }
        }
        return null;
      }

      // Function to generate triad notes
      function generateTriad(root, formula) {
        const useSharps = !root.includes('b');
        const scale = buildMajorScale(root, useSharps);
        if (!scale) return null;

        const degreeMap = {
          '1': 0,
          '2': 1,
          '3': 2,
          '4': 3,
          '5': 4,
          '6': 5,
          '7': 6
        };

        const notes = formula.map(interval => {
          let degree = interval.replace(/b|#/g, '');
          let note = scale[degreeMap[degree]];
          if (interval.includes('b')) {
            note = flattenNote(note);
          } else if (interval.includes('#')) {
            note = sharpenNote(note);
          }
          return note;
        });

        // Removed the following block to allow mixed accidentals in triad notes
        /*
        // Verify that we haven't mixed sharps and flats in triad notes
        const hasSharps = notes.some(n => n.includes('#'));
        const hasFlats = notes.some(n => n.includes('b'));
        if (hasSharps && hasFlats) return null;
        */

        return notes;
      }

      // Function to flatten a note (adds a flat or removes a sharp)
      function flattenNote(note) {
        if (note.endsWith('bb')) return note; // Avoid triple flats
        if (note.endsWith('b')) return note.replace('b', 'bb');
        if (note.endsWith('#')) return note.slice(0, -1);
        if (note.endsWith('##')) return note.replace('##', '#');
        return note + 'b';
      }

      // Function to sharpen a note (adds a sharp or removes a flat)
      function sharpenNote(note) {
        if (note.endsWith('##')) return note; // Avoid triple sharps
        if (note.endsWith('#')) return note.replace('#', '##');
        if (note.endsWith('b')) return note.slice(0, -1);
        if (note.endsWith('bb')) return note.replace('bb', 'b');
        return note + '#';
      }

      // Function to generate all permutations based on inversions and voicing
      function generatePermutations(notes, selectedInversions, spreadVoicing) {
        const permutations = [];
        const inversions = [];

        selectedInversions.forEach(inversionType => {
          if (inversionType === 'root') {
            permutations.push(notes);
            inversions.push('Root Position');
          } else if (inversionType === 'first') {
            permutations.push([notes[1], notes[2], notes[0]]);
            inversions.push('First Inversion');
          } else if (inversionType === 'second') {
            permutations.push([notes[2], notes[0], notes[1]]);
            inversions.push('Second Inversion');
          }
        });

        if (spreadVoicing) {
          const spreadPermutations = permute(notes);
          spreadPermutations.forEach(perm => {
            if (!isStandardInversion(perm, notes)) {
              permutations.push(perm);
              inversions.push('Spread Voicing');
            }
          });
        }

        // Remove duplicate permutations
        const uniquePermutations = [];
        const uniqueInversions = [];
        const seen = new Set();
        for (let i = 0; i < permutations.length; i++) {
          const key = permutations[i].join('-');
          if (!seen.has(key)) {
            seen.add(key);
            uniquePermutations.push(permutations[i]);
            uniqueInversions.push(inversions[i]);
          }
        }

        return uniquePermutations.map((perm, idx) => ({
          notes: perm,
          inversion: uniqueInversions[idx]
        }));
      }

      // Heap's algorithm for permutations
      function permute(arr) {
        const result = [];

        function generate(n, heapArr) {
          if (n === 1) {
            result.push(heapArr.slice());
          } else {
            for (let i = 0; i < n; i++) {
              generate(n - 1, heapArr);
              const j = n % 2 === 0 ? i : 0;
              [heapArr[n - 1], heapArr[j]] = [heapArr[j], heapArr[n - 1]];
            }
          }
        }

        generate(arr.length, arr.slice());
        return result;
      }

      // Function to check if permutation is a standard inversion
      function isStandardInversion(perm, original) {
        return (
          (perm[0] === original[0] && perm[1] === original[1] && perm[2] === original[2]) ||
          (perm[0] === original[1] && perm[1] === original[2] && perm[2] === original[0]) ||
          (perm[0] === original[2] && perm[1] === original[0] && perm[2] === original[1])
        );
      }

      // Function to initialize the quiz based on user selections
      function initializeQuiz() {
        const selectedTypes = [];
        if (document.getElementById('major').checked) selectedTypes.push('Major');
        if (document.getElementById('minor').checked) selectedTypes.push('Minor');
        if (document.getElementById('diminished').checked) selectedTypes.push('Diminished');
        if (document.getElementById('augmented').checked) selectedTypes.push('Augmented');

        const inversionCheckboxes = document.querySelectorAll('input[name="inversion"]:checked');
        const selectedInversions = Array.from(inversionCheckboxes).map(cb => cb.value);

        const spreadVoicing = document.getElementById('spread-voicing').checked;

        const modeRadios = document.getElementsByName('mode');
        let quizMode = 'name';
        for (let radio of modeRadios) {
          if (radio.checked) {
            quizMode = radio.value;
            break;
          }
        }

        // Get Sharps, Flats, and Naturals selections
        const selectedSharps = document.getElementById('sharps').checked;
        const selectedFlats = document.getElementById('flats').checked;
        const selectedNaturals = document.getElementById('naturals').checked;
        const selectedTheoreticalEnharmonics = document.getElementById('theoretical-enharmonics').checked;
        const selectedCircleEnharmonics = document.getElementById('circle-enharmonics').checked;

        let filteredRootNotes = [];

        // Add Naturals if selected
        if (selectedNaturals) {
          const naturalRoots = allRootNotes.filter(note => !note.includes('#') && !note.includes('b'));
          filteredRootNotes = filteredRootNotes.concat(naturalRoots);
        }

        // Add Sharps if selected
        if (selectedSharps) {
          const sharpRoots = allRootNotes.filter(note => note.includes('#'));
          filteredRootNotes = filteredRootNotes.concat(sharpRoots);
        }

        // Add Flats if selected
        if (selectedFlats) {
          const flatRoots = allRootNotes.filter(note => note.includes('b'));
          filteredRootNotes = filteredRootNotes.concat(flatRoots);
        }

        // Add theoretical enharmonics if selected
        if (selectedTheoreticalEnharmonics) {
          filteredRootNotes = filteredRootNotes.concat(theoreticalEnharmonics);
        }

        // Apply Circle of Fifths Enharmonic preferences if selected
        if (selectedCircleEnharmonics) {
          filteredRootNotes = filteredRootNotes.map(note => {
            return circleOfFifthsPreferred[note] || note;
          });
        }

        // Remove duplicates
        filteredRootNotes = [...new Set(filteredRootNotes)];

        // Remove any root notes with double accidentals (as per requirements)
        filteredRootNotes = filteredRootNotes.filter(note => {
          return !note.includes('##') && !note.includes('bb');
        });

        // If no roots match the selection, alert the user and return
        if (filteredRootNotes.length === 0) {
          alert('No root notes match the selected accidentals and enharmonic options. Please adjust your selections.');
          return;
        }

        quizSet = [];
        missedQuestions = {};

        filteredRootNotes.forEach(root => {
          triadTypes.forEach(triadType => {
            if (selectedTypes.includes(triadType.name)) {
              const triadNotes = generateTriad(root, triadType.formula);
              if (!triadNotes) return;
              const permutations = generatePermutations(triadNotes, selectedInversions, spreadVoicing);
              permutations.forEach(perm => {
                const questionKey = quizMode === 'name' ? perm.notes.join(' – ') : `${root} ${triadType.name} Triad (${perm.inversion})`;
                quizSet.push({
                  question: perm.notes.join(' – '),
                  answer: `${root} ${triadType.name} Triad`,
                  inversion: perm.inversion,
                  quizMode: quizMode,
                  key: questionKey,
                  notes: perm.notes // Store notes for reference
                });
              });
            }
          });
        });

        // Remove null entries from quizSet
        quizSet = quizSet.filter(q => q !== null);

        // Shuffle quiz set
        quizSet = shuffleArray(quizSet);

        // Initialize counters
        currentQuestionIndex = 0;
        correctAnswers = 0;
        incorrectAttempts = 0;
        totalQuestions = quizSet.length;

        // Hide start button and show quiz area
        document.getElementById('start-button').style.display = 'none';
        document.getElementById('quiz-area').style.display = 'block';
        document.getElementById('missed-list').innerHTML = '';

        // If no questions are available after filtering, alert the user
        if (quizSet.length === 0) {
          alert('No questions available based on the selected options. Please adjust your selections.');
          resetGame();
          return;
        }

        showNextQuestion();
      }

      // Function to show the next question
      function showNextQuestion() {
        if (quizSet.length === 0) {
          document.getElementById('quiz-question').textContent = 'Quiz Completed!';
          document.getElementById('reveal-button').style.display = 'none';
          document.getElementById('correct-button').style.display = 'none';
          document.getElementById('wrong-button').style.display = 'none';
          document.getElementById('answer').style.display = 'none';
          document.getElementById('progress').textContent = `Final Score: ${correctAnswers} Correct, ${incorrectAttempts} Incorrect Attempts`;
          return;
        }

        currentQuestion = quizSet[currentQuestionIndex];
        if (currentQuestion.quizMode === 'name') {
          document.getElementById('quiz-question').textContent = `What is the chord for: ${currentQuestion.question}?`;
        } else {
          document.getElementById('quiz-question').textContent = `Spell the ${currentQuestion.answer} (${currentQuestion.inversion})`;
        }
        document.getElementById('answer').style.display = 'none';
        document.getElementById('correct-button').style.display = 'none';
        document.getElementById('wrong-button').style.display = 'none';
        document.getElementById('reveal-button').style.display = 'inline-block';
        document.getElementById('progress').textContent = `Correct: ${correctAnswers}, Incorrect Attempts: ${incorrectAttempts}, Remaining Questions: ${quizSet.length}`;
      }

      // Function to reveal the answer
      function revealAnswer() {
        const inversionInfo = `(${currentQuestion.inversion})`;

        if (currentQuestion.quizMode === 'name') {
          document.getElementById('answer').textContent = `Answer: ${currentQuestion.answer} ${inversionInfo}`;
        } else {
          document.getElementById('answer').textContent = `Answer: ${currentQuestion.question} ${inversionInfo}`;
        }
        document.getElementById('answer').style.display = 'block';
        document.getElementById('correct-button').style.display = 'inline-block';
        document.getElementById('wrong-button').style.display = 'inline-block';
        document.getElementById('reveal-button').style.display = 'none';
      }

      // Function to handle correct answer
      function handleCorrect() {
        correctAnswers++;
        quizSet.splice(currentQuestionIndex, 1);
        if (currentQuestionIndex >= quizSet.length) {
          currentQuestionIndex = 0;
        }
        showNextQuestion();
      }

      // Function to handle wrong answer
      function handleWrong() {
        incorrectAttempts++;
        const key = currentQuestion.key;
        if (missedQuestions[key]) {
          missedQuestions[key]++;
        } else {
          missedQuestions[key] = 1;
        }
        updateMissedQuestions();
        currentQuestionIndex++;
        if (currentQuestionIndex >= quizSet.length) {
          currentQuestionIndex = 0;
        }
        showNextQuestion();
      }

      // Function to update missed questions list
      function updateMissedQuestions() {
        const missedList = document.getElementById('missed-list');
        missedList.innerHTML = '';
        for (const [question, count] of Object.entries(missedQuestions)) {
          const li = document.createElement('li');
          li.textContent = `${question} - Missed ${count} time(s)`;
          missedList.appendChild(li);
        }
      }

      // Function to reset the game
      function resetGame() {
        document.getElementById('quiz-area').style.display = 'none';
        document.getElementById('start-button').style.display = 'inline-block';
        document.getElementById('reveal-button').style.display = 'inline-block';
        document.getElementById('correct-button').style.display = 'none';
        document.getElementById('wrong-button').style.display = 'none';
        document.getElementById('answer').style.display = 'none';
        document.getElementById('quiz-question').textContent = '';
        document.getElementById('progress').textContent = '';
        document.getElementById('missed-list').innerHTML = '';
        missedQuestions = {};
      }

      // Function to shuffle an array
      function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
      }

      // Function to toggle instructions manual
      function toggleInstructions() {
        const instructions = document.getElementById('instructions-manual');
        const button = document.getElementById('instructions-button');
        if (instructions.style.display === 'none' || instructions.style.display === '') {
          instructions.style.display = 'block';
          button.textContent = 'Hide Instructions';
        } else {
          instructions.style.display = 'none';
          button.textContent = 'Show Instructions';
        }
      }

      // Event listeners
      document.getElementById('start-button').addEventListener('click', initializeQuiz);
      document.getElementById('reveal-button').addEventListener('click', revealAnswer);
      document.getElementById('correct-button').addEventListener('click', handleCorrect);
      document.getElementById('wrong-button').addEventListener('click', handleWrong);
      document.getElementById('reset-button').addEventListener('click', resetGame);
      document.getElementById('instructions-button').addEventListener('click', toggleInstructions);

      // Keyboard event listeners
      document.addEventListener('keydown', function(event) {
        if (event.key === ' ') {
          event.preventDefault();
          if (document.getElementById('reveal-button').style.display !== 'none') {
            revealAnswer();
          }
        } else if (event.key === '.') {
          if (document.getElementById('correct-button').style.display !== 'none') {
            handleCorrect();
          }
        } else if (event.key === ',') {
          if (document.getElementById('wrong-button').style.display !== 'none') {
            handleWrong();
          }
        }
      });

    })();
  </script>
  
</body>
</html>
